(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goodsbuy"],{1980:function(e,t,a){"use strict";a.r(t);var i=a("7542"),o=a.n(i);for(var s in i)"default"!==s&&function(e){a.d(t,e,function(){return i[e]})}(s);t["default"]=o.a},"266a":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("view",{staticClass:"goodsbuy ",staticStyle:{position:"fixed",width:"100%",height:"100%"},style:{paddingTop:e.system.statusBarHeight+"px"}},[a("view",{staticClass:"cu-bar "},[a("view",{staticClass:"action",attrs:{eventid:"1379091e-0"},on:{tap:e.back}},[a("text",{staticClass:"cuIcon-back"})]),a("view",{staticClass:"content text-bold"},[e._v("下单支付")])]),a("scroll-view",{staticStyle:{width:"100%",height:"100%"},attrs:{"scroll-y":"true"}},[a("form",[a("view",{staticClass:"cu-form-group margin-top"},[a("view",{staticClass:"title"},[e._v("收货人")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.receiver,expression:"receiver"}],attrs:{placeholder:"输入收货人姓名",name:"receiver",eventid:"1379091e-1"},domProps:{value:e.receiver},on:{input:function(t){t.target.composing||(e.receiver=t.target.value)}}})]),a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v("手机号")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"}],attrs:{placeholder:"输入收货人手机号",type:"tel",name:"phone",eventid:"1379091e-2"},domProps:{value:e.phone},on:{input:function(t){t.target.composing||(e.phone=t.target.value)}}})]),a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v("地址选择")]),a("picker",{attrs:{mode:"multiSelector",value:e.regionIndex,range:e.regionArray,eventid:"1379091e-3"},on:{change:e.selectRegion,columnchange:e.regionChange}},[a("view",{staticClass:"picker"},[e._v(e._s(e.region))])])],1),a("view",{staticClass:"cu-form-group"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.address,expression:"address"}],attrs:{maxlength:"-1",placeholder:"请输入详细地址",eventid:"1379091e-4"},domProps:{value:e.address},on:{input:function(t){t.target.composing||(e.address=t.target.value)}}})]),a("view",{staticClass:"cu-form-group align-start"},[a("view",{staticClass:"title"},[e._v("备注")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"remark"}],attrs:{maxlength:"-1",placeholder:"你想对卖家说什么",eventid:"1379091e-5"},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value)}}})]),a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v("商品规格")]),a("picker",{attrs:{mode:"selector",value:e.styleIndex,range:e.stylelist,eventid:"1379091e-6"},on:{change:e.selectStyle}},[a("view",{staticClass:"picker"},[e._v(e._s(e.styleIndex>-1?e.goods.style[e.styleIndex].styleName:"请选择"))])])],1),a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v("商品价格")]),a("text",{staticClass:"text-red text-bold text-xl"},[e._v(e._s(e.priceLabel))])]),a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v("购买数量")]),a("uni-number-box",{attrs:{min:1,max:10,value:e.count,eventid:"1379091e-7",mpcomid:"1379091e-0"},on:{change:e.countChange}})],1),a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v("运费")]),a("text",{staticClass:"text-red text-bold text-price text-xl"},[e._v(e._s(e.goods.post_fee))])]),null!=e.goods.discount_amount?a("view",{staticClass:"cu-form-group"},[a("view",{staticClass:"title"},[e._v(e._s(e.goods.discount_label))]),a("text",{staticClass:"text-red text-bold text-price text-xl"},[e._v(e._s(e.goods.discount_amount))])]):e._e()])],1),a("view",{staticClass:"cu-bar bg-white tabbar border shop fixed ",staticStyle:{top:"unset",bottom:"0","z-index":"100"}},[a("view",{staticClass:"flex-treble bg-white submit text-price text-red",staticStyle:{flex:"1","font-size":"60rpx"}},[e._v(e._s(e.price*e.count+e.goods.post_fee-(null!=e.goods.discount_amount?e.goods.discount_amount:0)))]),"wxpay"==e.paytype?a("view",{staticClass:"flex-sub bg-green submit",attrs:{eventid:"1379091e-8"},on:{tap:e.wxpay}},[e._v("微信支付")]):e._e(),"alipay"==e.paytype?a("view",{staticClass:"flex-sub bg-blue submit",attrs:{eventid:"1379091e-9"},on:{tap:e.alipay}},[e._v("支付宝支付")]):e._e(),"nopay"==e.paytype?a("view",{staticClass:"flex-sub bg-grey submit"},[e._v("请使用客户端或小程序")]):e._e()])],1)},o=[];a.d(t,"a",function(){return i}),a.d(t,"b",function(){return o})},"4a6b":function(e,t,a){"use strict";a("719a");var i=s(a("b0ce")),o=s(a("7a76"));function s(e){return e&&e.__esModule?e:{default:e}}Page((0,i.default)(o.default))},7542:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(a("b253"));function o(e){return e&&e.__esModule?e:{default:e}}var s={components:{uniNumberBox:i.default},data:function(){return{system:this.systemInfo(),goods:{},priceLabel:"",detaillist:[],stylelist:[],styleIndex:-1,promoteFlag:!1,promoteLabel:"",region:"",regionArray:[["请选择"],["请选择"],["请选择"]],regionIndex:[0,0,0],regionData:[],price:0,count:1,tobuy:!0,tobuyAnimation:{},paytype:"nopay",remark:"",address:"",receiver:this.getUserInfo().nick_name,phone:this.getUserInfo().phone}},onLoad:function(t){var a=this,i=t.goodsId,o=t.styleName;this.postJson({path:"/goods_new_detail.jsp",data:{goodsid:i},success:function(e){if(console.log(e.data),"ok"==e.data.status){a.$data.goods=e.data.data,a.promoteFlag=1==a.goods.promote,a.goods.price>a.goods.promote_price?a.priceLabel="¥"+a.goods.promote_price+" ~ ¥"+a.goods.max_price:a.priceLabel="¥"+a.goods.price+" ~ ¥"+a.goods.max_price,a.detaillist=a.goods.detail;var t=a.goods.style;for(var i in t){var s=t[i],r=s.styleName,n=s.goodsPrice,l=r+" ¥"+n,d=n;if(s.promotePrice){var c=s.promoteStarttime,u=s.promoteEndtime,p=Math.floor(Date().getTime()/1e3);p<c?(l=r+" ¥"+n,d=s.goodsPrice):p>u?(l=r+" ¥"+n,d=s.goodsPrice):(l=r+" ¥"+promotePrice,d=s.promotePrice)}else l=r+" ¥"+n,d=s.goodsPrice;a.stylelist.push(l),o==r&&(a.styleIndex=i,a.price=d,a.priceLabel="¥"+d)}}}});var s={multiArray:this.regionArray,multiIndex:this.regionIndex,multiData:this.regionData},r="100000";this.postJson({path:"/district.jsp",data:{code:r},success:function(e){if(console.log(e.data),"ok"==e.data.status){for(var t in s.multiData[0]=e.data.data,s.multiArray[0]=[],e.data.data){var i=e.data.data[t];s.multiArray[0].push(i.name)}s.multiIndex[1]=0,s.multiArray[1]=["请选择"],s.multiArray[2]=["请选择"],s.multiIndex[2]=0,a.regionArray=s.multiArray,a.regionIndex=s.multiIndex,a.regionData=s.multiData,a.region="xx省xx市xx县"}}}),e.getProvider({service:"payment",success:function(e){console.log(e.provider),~e.provider.indexOf("wxpay")?a.paytype="wxpay":~e.provider.indexOf("alipay")&&(a.paytype="alipay")}})},methods:{selectStyle:function(e){console.log("选择商品规格为",e.target.value),this.styleIndex=e.target.value;var t=this.goods.style[this.styleIndex];if(t.promotePrice){this.promoteFlag=!0;var a=t.promoteStarttime,i=t.promoteEndtime,o=Math.floor(Date().getTime()/1e3);o<a?(this.priceLabel="¥"+t.goodsPrice,this.promoteLabel=new Date(1e3*a).toLocaleDateString()+"开始",this.price=t.goodsPrice):o>i?(this.priceLabel="¥"+t.goodsPrice,this.promoteLabel="已结束",this.price=t.goodsPrice):(this.priceLabel="¥"+t.promotePrice,this.promoteLabel=new Date(1e3*i).toLocaleDateString()+"截止",this.price=t.promotePrice)}else this.priceLabel="¥"+t.goodsPrice,this.promoteFlag=!1,this.price=t.goodsPrice},selectRegion:function(e){this.multiIndex=e.detail.value},regionChange:function(t){var a=this,i=this,o={multiArray:this.regionArray,multiIndex:this.regionIndex,multiData:this.regionData};switch(o.multiIndex[t.detail.column]=t.detail.value,t.detail.column){case 0:var s=o.multiData[0][o.multiIndex[0]].code;this.postJson({path:"/district.jsp",data:{code:s},success:function(e){if(console.log(e.data),"ok"==e.data.status){for(var t in o.multiData[1]=e.data.data,o.multiArray[1]=[],e.data.data){var i=e.data.data[t];o.multiArray[1].push(i.name)}o.multiIndex[1]=0,o.multiArray[2]=["请选择"],o.multiIndex[2]=0,a.regionArray=o.multiArray,a.regionIndex=o.multiIndex,a.regionData=o.multiData}a.region=o.multiArray[0][o.multiIndex[0]]+"xx市xx县"}});break;case 1:var r=o.multiData[1][o.multiIndex[1]].code;e.request({url:"https://www.dpsoft.top/district.jsp",method:"POST",data:{code:r},header:{"Content-Type":"application/json"},success:function(e){if(console.log(e.data),"ok"==e.data.status){for(var t in o.multiData[2]=e.data.data,o.multiArray[2]=[],e.data.data){var s=e.data.data[t];o.multiArray[2].push(s.name)}o.multiIndex[2]=0,i.regionArray=o.multiArray,i.regionIndex=o.multiIndex,i.regionData=o.multiData}a.region=o.multiArray[0][o.multiIndex[0]]+o.multiArray[1][o.multiIndex[1]]+"xx县"}});break;case 2:this.region=o.multiArray[0][o.multiIndex[0]]+o.multiArray[1][o.multiIndex[1]]+o.multiArray[2][o.multiIndex[2]];break}},countChange:function(e){this.count=e},alipay:function(){},wxpay:function(){var t=this;if(this.receiver.trim().length<=0)e.showToast({icon:"none",title:"请填写收货人姓名"});else{var a=/^[1][3,4,5,7,8,9][0-9]{9}$/;if(null!=this.phone&&this.phone.trim().length>0&&a.test(this.phone))if("请选择"!=this.regionArray[0][this.regionIndex[0]])if("请选择"!=this.regionArray[1][this.regionIndex[1]])if("请选择"!=this.regionArray[2][this.regionIndex[2]])if(this.address.trim().length<=0)e.showToast({icon:"none",title:"请选填写收货详细地址"});else{var i={};i.goods_id=this.goods.id,i.number=this.count,i.remark=this.remark,i.receiver=this.receiver,i.phone=this.phone,i.address=this.regionArray[0][this.regionIndex[0]]+this.regionArray[1][this.regionIndex[1]]+this.regionArray[2][this.regionIndex[2]]+this.address,i.style=this.goods.style[this.styleIndex],i.tradeType="JSAPI",i.body="「好物短视频」"+this.goods.title,e.showLoading({title:"加载中",mask:!0}),this.getOpenId(function(a){console.log(a),a&&(i.openId=a.data.data.openid),t.postJson({path:"/order_wxpay_init.jsp",data:i,success:function(t){if(e.hideLoading(),"ok"==t.data.status){var a=t.data.data;a.success=function(t){e.showToast({title:"支付成功"}),e.redirectTo({url:"/pages/order/order?code"+a.code})},a.fail=function(t){e.showToast({icon:"none",title:"支付失败"})},a.provider="wxpay",e.requestPayment(a)}else e.showToast({icon:"none",title:t.data.msg})}})})}else e.showToast({icon:"none",title:"请选择收货地址市县"});else e.showToast({icon:"none",title:"请选择收货地址城市"});else e.showToast({icon:"none",title:"请选择收货地址省份"});else e.showToast({icon:"none",title:"请输入正确的收货人手机号"})}}}};t.default=s}).call(this,a("543d")["default"])},"7a76":function(e,t,a){"use strict";a.r(t);var i=a("266a"),o=a("1980");for(var s in o)"default"!==s&&function(e){a.d(t,e,function(){return o[e]})}(s);var r=a("2877"),n=Object(r["a"])(o["default"],i["a"],i["b"],!1,null,null,null);t["default"]=n.exports}},[["4a6b","common/runtime","common/vendor"]]]);