(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chatroom/chatroom"],{"0224":function(t,e,a){},"0279":function(t,e,a){"use strict";a.r(e);var i=a("db35"),n=a("da71");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("de99");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"0301":function(t,e,a){"use strict";a.r(e);var i=a("478a"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"0677":function(t,e,a){},"094e":function(t,e,a){},"0b80":function(t,e,a){"use strict";a("719a");var i=s(a("b0ce")),n=s(a("0279"));function s(t){return t&&t.__esModule?t:{default:t}}Page((0,i.default)(n.default))},"0d1e":function(t,e,a){"use strict";a.r(e);var i=a("3f1a"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"150a":function(t,e,a){"use strict";a.r(e);var i=a("1d21"),n=a("5ee6");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("52e0");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"1d21":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.recordStatus!=t.RecordStatus.HIDE?a("view",{staticClass:"modal modal-record",attrs:{eventid:"6c2ab73f-2"},on:{tap:t.toggleRecordModal}},[a("view",{staticClass:"modal-body",attrs:{eventid:"6c2ab73f-1"},on:{tap:t.toggleWithoutAction}},[a("view",{staticClass:"sound-waves"},[t._l(t.radomheight,function(t,e){return a("view",{key:e,style:{height:t+"rpx",marginTop:"-"+t/2+"rpx"}})}),a("view",{staticStyle:{clear:"both",width:"0",height:"0"}})],2),a("text",{staticClass:"desc"},[t._v(t._s(t.RecordDesc[t.recordStatus]))]),a("button",{staticClass:"dot",attrs:{eventid:"6c2ab73f-0"},on:{touchstart:t.handleRecording,touchmove:t.handleRecordingMove,touchend:t.handleRecordingCancel,touchcancel:t.handleRecordingCancel}},[a("image",{staticClass:"icon-mic",attrs:{src:"/static/images/send.png"}})])],1)]):t._e()},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"1f90":function(t,e,a){"use strict";a.r(e);var i=a("6b42"),n=a("0301");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("ad92");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"205f":function(t,e,a){"use strict";a.r(e);var i=a("6258"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"29ce":function(t,e,a){},"2f68":function(t,e,a){"use strict";a.r(e);var i=a("61fc"),n=a("3f2b");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("c63c");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"3f1a":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(a("150a")),n=o(a("2f68")),s=o(a("feaf"));function o(t){return t&&t.__esModule?t:{default:t}}var r=a("d04d"),c=a("b428"),u={components:{ChatSuitAudio:i.default,ChatMsglist:n.default,ChatInputbar:s.default},name:"chat",props:{username:{type:Object,value:{}},chatType:{type:String,value:c.chatType.SINGLE_CHAT}},data:function(){return{__comps__:{msglist:null,inputbar:null,audio:null}}},created:function(){},attached:function(){},mounted:function(){this.$data.__comps__.inputbar=this.$refs.inputbar,this.$data.__comps__.msglist=this.$refs.msglist,this.$data.__comps__.audio=this.$refs.audio},moved:function(){},detached:function(){},methods:{toggleRecordModal:function(){this.$data.__comps__.audio.toggleRecordModal()},normalScroll:function(){this.$data.__comps__.msglist.normalScroll(),this.$data.__comps__.inputbar.cancelEmoji()},shortScroll:function(){this.$data.__comps__.msglist.shortScroll()},saveSendMsg:function(t){r.saveMsg(t.msg,t.type),this.$data.__comps__.inputbar.cancelEmoji()},getMore:function(){his.$data.__comps__.msglist.getHistoryMsg()}}};e.default=u},"3f2b":function(t,e,a){"use strict";a.r(e);var i=a("57ce"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"478a":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("5ff1")["default"],n=a("b428"),s=a("4df4"),o={name:"ChatSuitMain",props:{username:{type:Object,value:{}},chatType:{type:String,value:n.chatType.SINGLE_CHAT}},data:function(){return{inputMessage:"",userMessage:""}},methods:{focus:function(){this.$emit("inputFocused",null,{bubbles:!0})},blur:function(){this.$emit("inputBlured",null,{bubbles:!0})},isGroupChat:function(){return this.chatType==n.chatType.CHAT_ROOM},getSendToParam:function(){return this.isGroupChat()?this.username.groupId:this.username.your},bindMessage:function(t){this.userMessage=t.detail.value},emojiAction:function(t){var e,a=this.userMessage.length-1;if(t&&"[del]"!=t)e=this.userMessage+t;else if("[del]"==t){var i=this.userMessage.lastIndexOf("["),n=this.userMessage.lastIndexOf("]"),s=n-i;e=-1!=n&&n==a&&s>=3&&s<=4?this.userMessage.slice(0,i):this.userMessage.slice(0,a)}this.userMessage=e,this.inputMessage=e},sendMessage:function(){var t=this;if(String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},this.userMessage.trim()){var e=i.conn.getUniqueId(),a=new i.message(n.TEXT,e);a.set({msg:this.userMessage,from:this.username.myName,to:this.getSendToParam(),roomType:!1,chatType:this.chatType,success:function(e,a){s.fire("em.chat.sendSuccess",e,t.userMessage)},fail:function(t,e){console.log("失败了")}}),this.chatType==n.chatType.CHAT_ROOM&&a.setGroup("groupchat"),i.conn.send(a.body),this.$emit("newTextMsg",{msg:a,type:n.TEXT},{bubbles:!0,composed:!0}),this.userMessage="",this.inputMessage=""}}},created:function(){},attached:function(){},moved:function(){},detached:function(){},ready:function(){}};e.default=o},"4c3c":function(t,e,a){"use strict";t.exports={PLAYING:"playing",PAUSE:"pause",STOP:"stop"}},"51ab":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("5ff1")["default"],n=a("b428"),s=a("ffc6"),o=s.RecordStatus,r=s.RecordDesc,c=a("4df4"),u=!1,d=[50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50,50],l={name:"ChatSuitAudio",props:{username:{type:Object,value:{}},chatType:{type:String,value:n.chatType.SINGLE_CHAT}},data:function(){return{changedTouches:null,recordStatus:o.HIDE,RecordStatus:o,RecordDesc:r,radomheight:d,recorderManager:t.getRecorderManager(),recordClicked:!1}},methods:{toggleWithoutAction:function(t){},toggleRecordModal:function(){this.recordStatus=this.recordStatus==o.HIDE?o.SHOW:o.HIDE,this.radomheight=d},handleRecordingMove:function(t){var e=t.touches[0],a=this.changedTouches;a&&(this.recordStatus==o.SWIPE&&a.pageY-e.pageY<20&&(this.recordStatus=o.HOLD),this.recordStatus==o.HOLD&&a.pageY-e.pageY>20&&(this.recordStatus=o.SWIPE))},handleRecording:function(e){var a=this;function i(){wx.getSetting({success:function(t){var e=t.authSetting["scope.record"];0==e?wx.openSetting({success:function(t){var e=t.authSetting["scope.record"];1==e?wx.showToast({title:"授权成功",icon:"success"}):wx.showToast({title:"请授权录音",icon:"none"}),a.setData({isLongPress:!1})}}):1==e?n():wx.authorize({scope:"scope.record",success:function(){wx.showToast({title:"授权成功",icon:"success"})}})},fail:function(){wx.showToast({title:"鉴权失败，请重试",icon:"none"})}})}function n(){a.changedTouches=e.touches[0],a.recordStatus=o.HOLD,u=!0,a.myradom();var i=a.recorderManager||t.getRecorderManager();i.onStart(function(){}),i.start({format:"mp3"}),setTimeout(function(){a.handleRecordingCancel(),u=!1},1e5)}a.recordClicked=!0,setTimeout(function(){1==a.recordClicked&&i()},350)},handleRecordingCancel:function(){var e=this;u=!1;var a=this.recorderManager;this.recordStatus==o.SWIPE?this.recordStatus=o.RELEASE:(this.recordStatus=o.HIDE,this.recordClicked=!1),a.onStop(function(a){if(e.recordStatus==o.RELEASE)return console.log("user canceled"),void(e.recordStatus=o.HIDE);a.duration<1e3?t.showToast({title:"录音时间太短",icon:"none"}):e.uploadRecord(a.tempFilePath,a.duration)}),a.stop()},isGroupChat:function(){return this.chatType==n.chatType.CHAT_ROOM},getSendToParam:function(){return this.isGroupChat()?this.username.groupId:this.username.your},uploadRecord:function(e,a){var s=i.config.appkey.split("#"),o=this,r=i.conn.context.accessToken;t.uploadFile({url:"https://a1.easemob.com/"+s[0]+"/"+s[1]+"/chatfiles",filePath:e,name:"file",header:{Authorization:"Bearer "+r},success:function(t){var s=i.conn.getUniqueId(),u=new i.message(n.AUDIO,s),d=JSON.parse(t.data);u.set({apiUrl:i.config.apiURL,accessToken:r,body:{type:n.AUDIO,url:d.uri+"/"+d.entities[0].uuid,filetype:"",filename:e,accessToken:r,length:Math.ceil(a/1e3)},from:o.username.myName,to:o.getSendToParam(),roomType:!1,chatType:o.chatType,success:function(t){c.fire("em.chat.sendSuccess",s)}}),o.isGroupChat()&&u.setGroup("groupchat"),u.body.length=Math.ceil(a/1e3),i.conn.send(u.body),o.$emit("newAudioMsg",{msg:u,type:n.AUDIO},{bubbles:!0,composed:!0})}})},myradom:function(){for(var t=this,e=t.radomheight,a=0;a<t.radomheight.length;a++)e[a]=100*Math.random().toFixed(2)+10;t.radomheight=e,u&&setTimeout(function(){t.myradom()},500)}},created:function(){},attached:function(){},moved:function(){},detached:function(){},ready:function(){}};e.default=l}).call(this,a("543d")["default"])},"52e0":function(t,e,a){"use strict";var i=a("b280"),n=a.n(i);n.a},"57ce":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("b166"));function n(t){return t&&t.__esModule?t:{default:t}}var s=a("d04d"),o=a("4df4"),r={SHORT:"scroll_view_change",NORMAL:"scroll_view"},c=0,u="",d=!1,l={components:{AudioMsg:i.default},name:"ChatMsglist",props:{username:{type:Object,value:{}}},data:function(){return{view:r.NORMAL,toView:"",chatMsg:[],visibility__:!0,isIPX:getApp().globalData.isIPX}},methods:{normalScroll:function(){this.view=r.NORMAL},shortScroll:function(){this.view=r.SHORT},onTap:function(){this.$emit("msglistTap",null,{bubbles:!0})},previewImage:function(e){var a=e.target.dataset.url;t.previewImage({urls:[a]})},getHistoryMsg:function(){var e=this,a=this.username,i=t.getStorageSync("myUsername"),n=a.groupId?a.groupId+i:a.your+i,s=t.getStorageSync("rendered_"+n)||[];if(c<s.length){var o=s.slice(-c-10,-c);this.setData({chatMsg:o.concat(e.data.chatMsg),toView:o[o.length-1].mid}),c+=o.length,10==o.length&&0,t.stopPullDownRefresh()}},renderMsg:function(e,a,i,n,s){i.length>1&&this.chatMsg.map(function(t,e){i.map(function(e,a){t.mid==e.mid&&i.splice(a,1)})});var o=t.getStorageSync("rendered_"+n)||[];if(o=o.concat(i),o.length){"newMsg"==s?(this.chatMsg=this.chatMsg.concat(i),this.toView=o[o.length-1].mid):(this.chatMsg=o.slice(-10),this.toView=o[o.length-1].mid),t.setStorageSync("rendered_"+n,o);var r=t.getStorageSync(n)||[];r.map(function(t,e){i.map(function(a,i){a.mid==t.mid&&r.splice(e,1)})}),t.setStorageSync(n,r),c=o.slice(-10).length,t.pageScrollTo({scrollTop:9999}),d&&this.renderFail(n)}},renderFail:function(e){var a=this,i=a.data.chatMsg;i.map(function(t){t.mid.substring(t.mid.length-10)==u.substring(u.length-10)&&(t.msg.data[0].isFail=!0,t.isFail=!0,a.setData({chatMsg:i}))}),a.curChatMsg[0].mid==u&&(a.curChatMsg[0].msg.data[0].isShow=!1,a.curChatMsg[0].isShow=!1),t.setStorageSync("rendered_"+e,i),d=!1}},created:function(){},attached:function(){this.$data.visibility__=!0,0,c=0},moved:function(){},detached:function(){this.$data.visibility__=!0},mounted:function(e){var a=this,i=this.username,n=t.getStorageSync("myUsername"),r=i.groupId?i.groupId+n:i.your+n,c=t.getStorageSync(r)||[];this.renderMsg(null,null,c,r),t.setStorageSync(r,null),o.on("em.xmpp.error.sendMsgErr",function(t){u=t.data.mid,d=!0}),s.on("newChatMsg",function(t,e,n,s){(!a.lastTime||(new Date).getTime()-a.lastTime>3e5)&&(t.showTime=!0,a.lastTime=(new Date).getTime()),a.curChatMsg=n,a.$data.visibility__&&(i.groupId?t.info.from!=i.groupId&&t.info.to!=i.groupId||s==r&&a.renderMsg(t,e,n,r,"newMsg"):t.info.from!=i.your&&t.info.to!=i.your||a.renderMsg(t,e,n,r,"newMsg"))})}};e.default=l}).call(this,a("543d")["default"])},"5cf9":function(t,e,a){"use strict";var i=a("b433"),n=a.n(i);n.a},"5ee6":function(t,e,a){"use strict";a.r(e);var i=a("51ab"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"61fc":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{class:t.view+" wrap "+(t.isIPX?"scroll_view_X":""),staticStyle:{"background-color":"#eeeeee"},attrs:{"scroll-y":"true",bindscroll:"scrollmore",bindscrolltoupper:"refresh","upper-threshold":"-50","scroll-into-view":"toView",eventid:"f0b51766-2"},on:{tap:t.onTap}},t._l(t.chatMsg,function(e,i){return a("view",{key:e.mid,staticClass:"message",staticStyle:{width:"100%","margin-top":"30rpx"},attrs:{id:e.mid}},[e.info.to!=t.username.your?a("view",{staticStyle:{display:"flex","justify-content":"flex-start","flex-wrap":"wrap"}},[1==e.showTime?a("view",{staticClass:"user",staticStyle:{display:"flex",flex:"0 0 100%","text-align":"center","justify-content":"center","margin-botton":"20rpx",bottom:"0"}},[a("text",{staticClass:"user-text",staticStyle:{padding:"6rpx 20rpx",color:"white","background-color":"#bbbbbb","border-radius":"10rpx"}},[t._v(t._s(e.time))])]):t._e(),a("image",{staticClass:"avatar",staticStyle:{float:"normal"},attrs:{src:t.username.sellerHead}}),a("view",{staticClass:"msg",staticStyle:{"margin-top":"0"}},[a("image",{class:["err","self"==e.style&&e.isFail?"show":"hide"],attrs:{src:"/static/images/msgerr.png"}}),"self"==e.style?a("image",{staticClass:"msg_poprightarrow",attrs:{src:"/static/images/poprightarrow@2x.png"}}):t._e(),""==e.style?a("image",{staticClass:"msg_popleftarrow",attrs:{src:"/static/images/popleftarrow@2x.png"}}):t._e(),"img"==e.msg.type||"video"==e.msg.type?a("view",["img"==e.msg.type?a("block",[a("image",{staticClass:"avatar",staticStyle:{width:"90px",height:"120px",margin:"2px auto"},attrs:{src:e.msg.data,mode:"aspectFit","data-url":e.msg.data,eventid:"f0b51766-0-"+i},on:{tap:t.previewImage}})]):t._e(),"video"==e.msg.type?a("block",[a("video",{attrs:{src:e.msg.data,controls:"",autoplay:""}})]):t._e()],1):t._e(),"audio"==e.msg.type?a("audio-msg",{attrs:{msg:e,mpcomid:"f0b51766-0-"+i}}):"txt"==e.msg.type||"emoji"==e.msg.type?a("view",t._l(e.msg.data,function(e,i){return a("view",{key:i,staticClass:"template"},["txt"==e.type?a("block",[a("text",{staticClass:"msg-text",staticStyle:{float:"left"}},[t._v(t._s(e.data))])]):t._e(),"emoji"==e.type?a("block",[a("image",{staticClass:"avatar",staticStyle:{width:"25px",height:"25px",margin:"0 0 2px 0",float:"left"},attrs:{src:"/static/images/faces/"+e.data}})]):t._e(),"audio"==e.type?a("block",[a("audio",{attrs:{src:e.url,controls:"",autoplay:""}})],1):t._e()],1)})):t._e()],1)]):a("view",{staticClass:"main",class:e.style,staticStyle:{display:"flex","flex-direction":"row-reverse","justify-content":"flex-start","flex-wrap":"wrap"}},[1==e.showTime?a("view",{staticClass:"user",staticStyle:{display:"flex",flex:"0 0 100%","text-align":"center","justify-content":"center","margin-botton":"20rpx",bottom:"0"}},[a("text",{staticClass:"user-text",staticStyle:{padding:"6rpx 20rpx",color:"white","background-color":"#bbbbbb","border-radius":"10rpx"}},[t._v(t._s(e.time))])]):t._e(),a("image",{staticClass:"avatar",staticStyle:{"margin-left":"20rpx","margin-right":"0"},attrs:{src:t.username.me.head_img}}),a("view",{staticClass:"msg",staticStyle:{"background-color":"#e3c77f","margin-top":"0"}},[a("image",{class:["err","self"==e.style&&e.isFail?"show":"hide"],attrs:{src:"/static/images/msgerr.png"}}),a("image",{staticClass:"msg_poprightarrow",staticStyle:{position:"flex"},attrs:{src:"/static/images/poprightarrow@2x.png"}}),"img"==e.msg.type||"video"==e.msg.type?a("view",["img"==e.msg.type?a("block",[a("image",{staticClass:"avatar",staticStyle:{width:"90px",height:"120px",margin:"2px auto"},attrs:{src:e.msg.data,mode:"aspectFit","data-url":e.msg.data,eventid:"f0b51766-1-"+i},on:{tap:t.previewImage}})]):t._e(),"video"==e.msg.type?a("block",[a("video",{attrs:{src:e.msg.data,controls:"",autoplay:""}})]):t._e()],1):t._e(),"audio"==e.msg.type?a("audio-msg",{attrs:{msg:e,mpcomid:"f0b51766-1-"+i}}):"txt"==e.msg.type||"emoji"==e.msg.type?a("view",t._l(e.msg.data,function(e,i){return a("view",{key:i,staticClass:"template"},["txt"==e.type?a("block",[a("text",{staticClass:"msg-text",staticStyle:{float:"left"}},[t._v(t._s(e.data))])]):t._e(),"emoji"==e.type?a("block",[a("image",{staticClass:"avatar",staticStyle:{width:"25px",height:"25px",margin:"0 0 2px 0",float:"left"},attrs:{src:"/static/images/faces/"+e.data}})]):t._e(),"audio"==e.type?a("block",[a("audio",{attrs:{src:e.url,controls:"",autoplay:""}})],1):t._e()],1)})):t._e()],1)])])}))},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},6258:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("5ff1")["default"],n=a("b428"),s={OPENED:"showEmoji",CLOSED:"emoji_list"},o={name:"ChatSuitEmoji",data:function(){return{show:s.CLOSED,emoji:i.Emoji,emojiObj:i.EmojiObj,interval:5e3,duration:1e3,autoplay:!1,indicatorDots:!0}},methods:{openEmoji:function(){this.show=s.OPENED},cancelEmoji:function(){this.show=s.CLOSED},sendEmoji:function(t){var e=t.target.dataset.emoji;this.$emit("newEmojiStr",{msg:e,type:n.EMOJI},{bubbles:!0,composed:!0})}}};e.default=o},"6b42":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"text-input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.inputMessage,expression:"inputMessage"}],staticClass:"f news",attrs:{type:"text","cursor-spacing":"65","confirm-type":"send",placeholder:"输入新消息","placeholder-style":"color:#CFCFCF; padding-left:5px;",eventid:"7be8809e-0"},domProps:{value:t.inputMessage},on:{confirm:t.sendMessage,input:[function(e){e.target.composing||(t.inputMessage=e.target.value)},t.bindMessage],tap:t.focus,focus:t.focus,blur:t.blur}})])},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"6d6b":function(t,e,a){"use strict";a.r(e);var i=a("ae05"),n=a("205f");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("8b71");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},"6fd2":function(t,e,a){},7273:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",[a("view",{staticClass:"main",staticStyle:{"background-color":"#eeeeee"}},[a("chat-suit-audio",{ref:"audio",attrs:{username:t.username,chatType:t.chatType,eventid:"ddde1a0c-0",mpcomid:"ddde1a0c-0"},on:{newAudioMsg:t.saveSendMsg}}),a("chat-msglist",{ref:"msglist",attrs:{username:t.username,eventid:"ddde1a0c-1",mpcomid:"ddde1a0c-1"},on:{msglistTap:t.normalScroll}})],1),a("chat-inputbar",{ref:"inputbar",attrs:{username:t.username,chatType:t.chatType,eventid:"ddde1a0c-2",mpcomid:"ddde1a0c-2"},on:{newTextMsg:t.saveSendMsg,newImageMsg:t.saveSendMsg,newLocationMsg:t.saveSendMsg,newVideoMsg:t.saveSendMsg,tapSendAudio:t.toggleRecordModal,inputFocused:t.shortScroll,inputBlured:t.normalScroll}})],1)},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},7656:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"room_bar"},[a("chat-suit-emoji",{ref:"emoji",attrs:{eventid:"76cc1a26-0",mpcomid:"76cc1a26-0"},on:{newEmojiStr:t.emojiAction}}),a("chat-suit-main",{ref:"main",attrs:{username:t.username,chatType:t.chatType,eventid:"76cc1a26-1",mpcomid:"76cc1a26-1"},on:{inputFocused:t.cancelEmoji,newTextMsg:t.sendTextMessage}}),a("chat-suit-image",{ref:"image",attrs:{username:t.username,chatType:t.chatType,eventid:"76cc1a26-2",mpcomid:"76cc1a26-2"},on:{newImageMsg:t.sendImageMessage}}),a("view",{class:["other_func",t.isIPX?"other_func_X":""]},[a("view",{staticClass:"open_emoji",attrs:{eventid:"76cc1a26-3"},on:{tap:t.openEmoji}},[a("image",{attrs:{src:"/static/images/Emoji.png"}})]),a("view",{staticClass:"v-record",attrs:{eventid:"76cc1a26-4"},on:{tap:t.toggleRecordModal}},[a("image",{staticClass:"icon-record",staticStyle:{width:"16px",height:"24px"},attrs:{src:t.recordStatus!=t.RecordStatus.HIDE?"/static/images/iconAudioActive@2x.png":"/static/images/voice.png"}})]),a("view",{staticClass:"open_camera",attrs:{eventid:"76cc1a26-5"},on:{tap:t.openCamera}},[a("image",{staticStyle:{width:"24px",height:"18px"},attrs:{src:"/static/images/camora.png"}})]),a("view",{staticClass:"send_image",attrs:{eventid:"76cc1a26-6"},on:{tap:t.sendImage}},[a("image",{staticStyle:{height:"20px",width:"20px"},attrs:{src:"/static/images/pic.png"}})])])],1)},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},7869:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view")},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"7c77":function(t,e,a){"use strict";var i={},n=null,s={};function o(t){var e=t.play,a=t.pause;function i(){n&&n!=this&&n.pause(),e.call(this),n=this}function s(){n==this&&a.call(this)}t.play=i,t.pause=s}t.exports={getCtx:function(t){var e=i[t];return e||(e=wx.createInnerAudioContext(),i[t]=e,o(e)),e},getAllCtx:function(){return wx.setStorageSync("allCtx",JSON.stringify(Object.keys(i))),i},getCommponet:function(t,e){var a=s[t];return a||(s[t]=e),s}}},"7d7f":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(a("f35f"));function n(t){return t&&t.__esModule?t:{default:t}}var s=a("4df4"),o={components:{chat:i.default},data:function(){return{username:{your:""}}},onLoad:function(e){var a=JSON.parse(e.username);this.username=a,t.setNavigationBarTitle({title:a.sellerName})},onUnload:function(){s.fire("em.chatroom.leave")},onPullDownRefresh:function(){t.showNavigationBarLoading(),this.selectComponent("#chat").getMore(),t.hideNavigationBarLoading(),t.stopPullDownRefresh()}};e.default=o}).call(this,a("543d")["default"])},"7db6":function(t,e,a){"use strict";a.r(e);var i=a("e31d"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},"85c6":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"audio-player",style:{opacity:t.opcity},attrs:{eventid:"3e4dc81a-0"},on:{tap:t.audioPlay}},[a("text",{staticClass:"time"},[t._v("语音消息 "+t._s(t.time))]),a("view",{staticClass:"controls play-btn",attrs:{"bind:tap":"audioPlay"}},[a("image",{attrs:{src:"self"==t.style?"/static/images/voicemsgmy.png":"/static/images/voicemsg.png"}})])])},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},"8b71":function(t,e,a){"use strict";var i=a("0224"),n=a.n(i);n.a},"9e2d":function(t,e,a){"use strict";a.r(e);var i=a("7869"),n=a("7db6");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},a028:function(t,e,a){},ad92:function(t,e,a){"use strict";var i=a("29ce"),n=a.n(i);n.a},ae05:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("swiper",{class:t.show,attrs:{"indicator-dots":t.indicatorDots,autoplay:t.autoplay,interval:t.interval,duration:t.duration}},[a("block",[a("swiper-item",{attrs:{mpcomid:"b1d927c2-0"}},[a("view",{staticClass:"emoji_item"},t._l(t.emojiObj.map1,function(e,i){return a("image",{key:i,attrs:{src:t.emojiObj.path+e,"data-emoji":i,eventid:"b1d927c2-0-"+i},on:{tap:t.sendEmoji}})})),a("view",{staticClass:"emoji_item"},t._l(t.emojiObj.map2,function(e,i){return a("image",{key:i,attrs:{src:t.emojiObj.path+e,"data-emoji":i,eventid:"b1d927c2-1-"+i},on:{tap:t.sendEmoji}})})),a("view",{staticClass:"emoji_item"},t._l(t.emojiObj.map3,function(e,i){return a("image",{key:i,attrs:{src:t.emojiObj.path+e,"data-emoji":i,eventid:"b1d927c2-2-"+i},on:{tap:t.sendEmoji}})}))])],1),a("block",{staticClass:"second"},[a("swiper-item",{attrs:{mpcomid:"b1d927c2-1"}},[a("view",{staticClass:"emoji_item"},t._l(t.emojiObj.map4,function(e,i){return a("image",{key:i,attrs:{src:t.emojiObj.path+e,"data-emoji":i,eventid:"b1d927c2-3-"+i},on:{tap:t.sendEmoji}})})),a("view",{staticClass:"emoji_item"},t._l(t.emojiObj.map5,function(e,i){return a("image",{key:i,attrs:{src:t.emojiObj.path+e,"data-emoji":i,eventid:"b1d927c2-4-"+i},on:{tap:t.sendEmoji}})})),a("view",{staticClass:"emoji_item"},t._l(t.emojiObj.map6,function(e,i){return a("image",{key:i,attrs:{src:t.emojiObj.path+e,"data-emoji":i,eventid:"b1d927c2-5-"+i},on:{tap:t.sendEmoji}})}))])],1)],1)},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},b166:function(t,e,a){"use strict";a.r(e);var i=a("85c6"),n=a("de7e");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("e51a");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},b280:function(t,e,a){},b433:function(t,e,a){},bbdd:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,n=a("7c77"),s=a("4c3c"),o=t.createInnerAudioContext();o?(o.obeyMuteSwitch=!1,o.autoplay=!0):(myaudio.obeyMuteSwitch=!1,myaudio.autoplay=!0);var r={name:"AudioMsg",props:{msg:{type:Object,val:{}}},data:function(){return{playStatus:s,curStatus:s.STOP,time:"0'",opcity:1,comps__:{audioCtx:null}}},methods:{audioPlay:function(){i&&clearInterval(i);var e=this.comps__.audioCtx,a="";t.downloadFile({url:this.msg.msg.data,header:{"X-Requested-With":"XMLHttpRequest",Accept:"audio/mp3",Authorization:"Bearer "+this.msg.msg.token},success:function(t){a=t.tempFilePath,console.log("音频本地",e),e.src=a,e.play()},fail:function(e){console.log("downloadFile failed",e),t.showToast({title:"下载失败",duration:1e3})}})},audioPause:function(t){var e=this.comps__.audioCtx=n.getCtx(this.msg.mid)||t;e&&e.pause()},addEvent:function(){var t=this.comps__.audioCtx;t.onPlay(this.onPlaying),t.onPause(this.onPause),t.onWaiting(this.onPause),t.onStop(this.onDone),t.onEnded(this.onDone),t.onError(this.onDone),t.onWaiting(this.onWait)},delEvent:function(){var t=this.comps__.audioCtx;t.offPlay(this.onPlaying),t.offPause(this.onPause),t.offWaiting(this.onPause),t.offStop(this.onDone),t.offEnded(this.onDone),t.offError(this.onDone),t.offWaiting(this.onWait)}},created:function(){},beforeMount:function(){this.time=this.msg.msg.length+"''",this.style=this.msg.style},moved:function(){},destroyed:function(){var t=this.comps__.audioCtx=n.getCtx(this.msg.mid);this.audioPause(t),this.delEvent()},mounted:function(){var t=this,e=this.comps__.audioCtx=n.getCtx(this.msg.mid);e.autoplay=!1,e.loop=!1,this.onPlaying=function(){t.curStatus=s.PLAYING,i&&clearInterval(i),i=setInterval(function(){var e=t.opcity;t.opcity=1==e?.4:1},500)},this.onPause=function(){parseInt(t.time,10)<1||(t.curStatus=s.PAUSE,t.opcity=1)},this.onDone=function(){t.curStatus=s.STOP,t.opcity=1,clearInterval(i)},this.onTimeUpdate=function(){t.time=(e.currentTime>>0)+"'"},this.onWait=function(){},this.addEvent()}};e.default=r}).call(this,a("543d")["default"])},c63c:function(t,e,a){"use strict";var i=a("094e"),n=a.n(i);n.a},d628:function(t,e,a){"use strict";var i=a("a028"),n=a.n(i);n.a},da71:function(t,e,a){"use strict";a.r(e);var i=a("7d7f"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},db35:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("chat",{attrs:{id:"chat",username:t.username,chatType:"singleChat",mpcomid:"57d1514c-0"}})},n=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return n})},de7e:function(t,e,a){"use strict";a.r(e);var i=a("bbdd"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},de99:function(t,e,a){"use strict";var i=a("0677"),n=a.n(i);n.a},e31d:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("5ff1")["default"],n=a("b428"),s=a("4df4"),o={name:"ChatSuitImage",props:{username:{type:Object,value:{}},chatType:{type:String,value:n.chatType.SINGLE_CHAT}},data:function(){return{}},methods:{openCamera:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["camera"],success:function(t){e.upLoadImage(t)}})},sendImage:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){e.upLoadImage(t)}})},isGroupChat:function(){return this.chatType==n.chatType.CHAT_ROOM},getSendToParam:function(){return this.isGroupChat()?this.username.groupId:this.username.your},upLoadImage:function(e){var a=this,o=e.tempFilePaths,r=i.conn.context.accessToken;t.getImageInfo({src:e.tempFilePaths[0],success:function(e){var c=i.config.appkey.split("#"),u=e.width,d=e.height,l=(e.path.lastIndexOf("."),e.type);t.uploadFile({url:"http://a1.easemob.com/"+c[0]+"/"+c[1]+"/chatfiles",filePath:o[0],name:"file",header:{Authorization:"Bearer "+r},success:function(t){var e=t.data,r=JSON.parse(e),c=i.conn.getUniqueId(),f=new i.message(n.IMAGE,c),m={type:n.IMAGE,size:{width:u,height:d},url:r.uri+"/"+r.entities[0].uuid,filetype:l,filename:o[0]};f.set({apiUrl:i.config.apiURL,body:m,from:a.username.myName,to:a.getSendToParam(),roomType:!1,chatType:a.chatType,success:function(t){s.fire("em.chat.sendSuccess",c)}}),a.chatType==n.chatType.CHAT_ROOM&&f.setGroup("groupchat"),i.conn.send(f.body),a.$emit("newImageMsg",{msg:f,type:n.IMAGE},{bubbles:!0,composed:!0})}})}})}}};e.default=o}).call(this,a("543d")["default"])},e3f9:function(t,e,a){"use strict";a.r(e);var i=a("f4a9"),n=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=n.a},e51a:function(t,e,a){"use strict";var i=a("6fd2"),n=a.n(i);n.a},f35f:function(t,e,a){"use strict";a.r(e);var i=a("7273"),n=a("0d1e");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("d628");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},f4a9:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o(a("6d6b")),n=o(a("1f90")),s=o(a("9e2d"));function o(t){return t&&t.__esModule?t:{default:t}}var r=a("ffc6").RecordStatus,c=a("b428"),u={components:{ChatSuitEmoji:i.default,ChatSuitMain:n.default,ChatSuitImage:s.default},name:"ChatInputbar",props:{username:{type:Object,value:{}},chatType:{type:String,value:c.chatType.SINGLE_CHAT}},data:function(){return{recordStatus:r.HIDE,RecordStatus:r,__comps__:{main:null,emoji:null,image:null,location:null},isIPX:getApp().globalData.isIPX}},created:function(){},mounted:function(){var t=this.$refs;t.main=this.$refs.main,t.emoji=this.$refs.emoji,t.image=this.$refs.image,this.$refs=t},methods:{toggleRecordModal:function(){this.$emit("tapSendAudio",null,{bubbles:!0,composed:!0})},openCamera:function(){this.$refs.image.openCamera()},openEmoji:function(){this.$refs.emoji.openEmoji()},cancelEmoji:function(){this.$refs.emoji.cancelEmoji()},sendImage:function(){this.$refs.image.sendImage()},sendLocation:function(){},emojiAction:function(t){this.$refs.main.emojiAction(t.msg)},sendTextMessage:function(t){this.$emit("newTextMsg",t,{bubbles:!0,composed:!0})},sendImageMessage:function(t){this.$emit("newImageMsg",t,{bubbles:!0,composed:!0})}},attached:function(){},moved:function(){},detached:function(){}};e.default=u},feaf:function(t,e,a){"use strict";a.r(e);var i=a("7656"),n=a("e3f9");for(var s in n)"default"!==s&&function(t){a.d(e,t,function(){return n[t]})}(s);a("5cf9");var o=a("2877"),r=Object(o["a"])(n["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},ffc6:function(t,e,a){"use strict";t.exports={RecordDesc:{0:"长按开始录音",2:"向上滑动取消",3:"松开手取消"},RecordStatus:{SHOW:0,HIDE:1,HOLD:2,SWIPE:3,RELEASE:4}}}},[["0b80","common/runtime","common/vendor"]]]);