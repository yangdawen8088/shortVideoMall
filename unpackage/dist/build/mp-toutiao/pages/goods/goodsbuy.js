(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goodsbuy"],{1980:function(t,e,a){"use strict";a.r(e);var i=a("2924"),s=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},"266a":function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("view",{staticClass:"goodsbuy ",staticStyle:{position:"fixed",width:"100%",height:"100%"},style:{paddingTop:t.system.statusBarHeight+"px"},attrs:{_hid:0}},[a("view",{staticClass:"cu-bar ",attrs:{_hid:1}},[a("view",{staticClass:"action",attrs:{_hid:2},on:{tap:t.back}},[a("text",{staticClass:"cuIcon-back",attrs:{_hid:3}})]),a("view",{staticClass:"content text-bold",attrs:{_hid:4}},[])]),a("scroll-view",{staticStyle:{width:"100%",height:"100%"},attrs:{"scroll-y":"true",_hid:6}},[a("form",{attrs:{_hid:7}},[a("view",{staticClass:"cu-form-group margin-top",attrs:{_hid:8}},[a("view",{staticClass:"title",attrs:{_hid:9}},[]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.receiver,expression:"receiver"}],attrs:{placeholder:"输入收货人姓名",name:"receiver",_hid:11},domProps:{value:t.receiver},on:{input:function(e){e.target.composing||(t.receiver=e.target.value)}}})]),a("view",{staticClass:"cu-form-group",attrs:{_hid:12}},[a("view",{staticClass:"title",attrs:{_hid:13}},[]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.phone,expression:"phone"}],attrs:{placeholder:"输入收货人手机号",type:"tel",name:"phone",_hid:15},domProps:{value:t.phone},on:{input:function(e){e.target.composing||(t.phone=e.target.value)}}})]),a("view",{staticClass:"cu-form-group",attrs:{_hid:16}},[a("view",{staticClass:"title",attrs:{_hid:17}},[]),a("picker",{attrs:{mode:"multiSelector",value:t.regionIndex,range:t.regionArray,_hid:19,_batrs:"value,range"},on:{change:t.selectRegion,columnchange:t.regionChange}},[a("view",{staticClass:"picker",attrs:{_hid:20}},[t._v(t._s(t.region),21)])])],1),a("view",{staticClass:"cu-form-group",attrs:{_hid:22}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.address,expression:"address"}],attrs:{maxlength:"-1",placeholder:"请输入详细地址",_hid:23},domProps:{value:t.address},on:{input:function(e){e.target.composing||(t.address=e.target.value)}}})]),a("view",{staticClass:"cu-form-group align-start",attrs:{_hid:24}},[a("view",{staticClass:"title",attrs:{_hid:25}},[]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:t.remark,expression:"remark"}],attrs:{maxlength:"-1",placeholder:"你想对卖家说什么",_hid:27},domProps:{value:t.remark},on:{input:function(e){e.target.composing||(t.remark=e.target.value)}}})]),a("view",{staticClass:"cu-form-group",attrs:{_hid:28}},[a("view",{staticClass:"title",attrs:{_hid:29}},[]),a("picker",{attrs:{mode:"selector",value:t.styleIndex,range:t.stylelist,_hid:31,_batrs:"value,range"},on:{change:t.selectStyle}},[a("view",{staticClass:"picker",attrs:{_hid:32}},[t._v(t._s(t.styleIndex>-1?t.goods.style[t.styleIndex].styleName:"请选择"),33)])])],1),a("view",{staticClass:"cu-form-group",attrs:{_hid:34}},[a("view",{staticClass:"title",attrs:{_hid:35}},[]),a("text",{staticClass:"text-red text-bold text-xl",attrs:{_hid:37}},[t._v(t._s(t.priceLabel),38)])]),a("view",{staticClass:"cu-form-group",attrs:{_hid:39}},[a("view",{staticClass:"title",attrs:{_hid:40}},[]),a("uni-number-box",{attrs:{min:1,max:10,value:t.count,_hid:42,_batrs:"min,max,value",_cid:0},on:{change:t.countChange}})],1),a("view",{staticClass:"cu-form-group",attrs:{_hid:1044}},[a("view",{staticClass:"title",attrs:{_hid:1045}},[]),a("text",{staticClass:"text-red text-bold text-price text-xl",attrs:{_hid:1047}},[t._v(t._s(t.goods.post_fee),1048)])]),t._ri(!(null==t.goods.discount_amount),1049)?a("view",{staticClass:"cu-form-group",attrs:{_hid:1049}},[a("view",{staticClass:"title",attrs:{_hid:1050}},[t._v(t._s(t.goods.discount_label),1051)]),a("text",{staticClass:"text-red text-bold text-price text-xl",attrs:{_hid:1052}},[t._v(t._s(t.goods.discount_amount),1053)])]):t._e()])],1),a("view",{staticClass:"cu-bar bg-white tabbar border shop fixed ",staticStyle:{top:"unset",bottom:"0","z-index":"100"},attrs:{_hid:1054}},[a("view",{staticClass:"flex-treble bg-white submit text-price text-red",staticStyle:{flex:"1","font-size":"60rpx"},attrs:{_hid:1055}},[t._v(t._s(t.price*t.count+t.goods.post_fee-(null!=t.goods.discount_amount?t.goods.discount_amount:0)),1056)]),t._ri(!("wxpay"!=t.paytype),1057)?a("view",{staticClass:"flex-sub bg-green submit",attrs:{_hid:1057},on:{tap:t.wxpay}},[]):t._e(),t._ri(!("alipay"!=t.paytype),1059)?a("view",{staticClass:"flex-sub bg-blue submit",attrs:{_hid:1059},on:{tap:t.alipay}},[]):t._e(),t._ri(!("nopay"!=t.paytype),1061)?a("view",{staticClass:"flex-sub bg-grey submit",attrs:{_hid:1061}},[]):t._e()])],1)},s=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return s})},2924:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=s(a("b253"));function s(t){return t&&t.__esModule?t:{default:t}}var o={components:{uniNumberBox:i.default},data:function(){return{system:this.systemInfo(),goods:{},priceLabel:"",detaillist:[],stylelist:[],styleIndex:-1,promoteFlag:!1,promoteLabel:"",region:"",regionArray:[["请选择"],["请选择"],["请选择"]],regionIndex:[0,0,0],regionData:[],price:0,count:1,tobuy:!0,tobuyAnimation:{},paytype:"nopay",remark:"",address:"",receiver:this.getUserInfo().nick_name,phone:this.getUserInfo().phone}},onLoad:function(e){var a=this,i=e.goodsId,s=e.styleName;this.postJson({path:"/goods_new_detail.jsp",data:{goodsid:i},success:function(t){if(console.log(t.data),"ok"==t.data.status){a.$data.goods=t.data.data,a.promoteFlag=1==a.goods.promote,a.goods.price>a.goods.promote_price?a.priceLabel="¥"+a.goods.promote_price+" ~ ¥"+a.goods.max_price:a.priceLabel="¥"+a.goods.price+" ~ ¥"+a.goods.max_price,a.detaillist=a.goods.detail;var e=a.goods.style;for(var i in e){var o=e[i],r=o.styleName,n=o.goodsPrice,l=r+" ¥"+n,d=n;if(o.promotePrice){var c=o.promoteStarttime,u=o.promoteEndtime,p=Math.floor(Date().getTime()/1e3);p<c?(l=r+" ¥"+n,d=o.goodsPrice):p>u?(l=r+" ¥"+n,d=o.goodsPrice):(l=r+" ¥"+promotePrice,d=o.promotePrice)}else l=r+" ¥"+n,d=o.goodsPrice;a.stylelist.push(l),s==r&&(a.styleIndex=i,a.price=d,a.priceLabel="¥"+d)}}}});var o={multiArray:this.regionArray,multiIndex:this.regionIndex,multiData:this.regionData},r="100000";this.postJson({path:"/district.jsp",data:{code:r},success:function(t){if(console.log(t.data),"ok"==t.data.status){for(var e in o.multiData[0]=t.data.data,o.multiArray[0]=[],t.data.data){var i=t.data.data[e];o.multiArray[0].push(i.name)}o.multiIndex[1]=0,o.multiArray[1]=["请选择"],o.multiArray[2]=["请选择"],o.multiIndex[2]=0,a.regionArray=o.multiArray,a.regionIndex=o.multiIndex,a.regionData=o.multiData,a.region="xx省xx市xx县"}}}),t.getProvider({service:"payment",success:function(t){console.log(t.provider),~t.provider.indexOf("wxpay")?a.paytype="wxpay":~t.provider.indexOf("alipay")&&(a.paytype="alipay")}})},methods:{selectStyle:function(t){console.log("选择商品规格为",t.target.value),this.styleIndex=t.target.value;var e=this.goods.style[this.styleIndex];if(e.promotePrice){this.promoteFlag=!0;var a=e.promoteStarttime,i=e.promoteEndtime,s=Math.floor(Date().getTime()/1e3);s<a?(this.priceLabel="¥"+e.goodsPrice,this.promoteLabel=new Date(1e3*a).toLocaleDateString()+"开始",this.price=e.goodsPrice):s>i?(this.priceLabel="¥"+e.goodsPrice,this.promoteLabel="已结束",this.price=e.goodsPrice):(this.priceLabel="¥"+e.promotePrice,this.promoteLabel=new Date(1e3*i).toLocaleDateString()+"截止",this.price=e.promotePrice)}else this.priceLabel="¥"+e.goodsPrice,this.promoteFlag=!1,this.price=e.goodsPrice},selectRegion:function(t){this.multiIndex=t.detail.value},regionChange:function(e){var a=this,i=this,s={multiArray:this.regionArray,multiIndex:this.regionIndex,multiData:this.regionData};switch(s.multiIndex[e.detail.column]=e.detail.value,e.detail.column){case 0:var o=s.multiData[0][s.multiIndex[0]].code;this.postJson({path:"/district.jsp",data:{code:o},success:function(t){if(console.log(t.data),"ok"==t.data.status){for(var e in s.multiData[1]=t.data.data,s.multiArray[1]=[],t.data.data){var i=t.data.data[e];s.multiArray[1].push(i.name)}s.multiIndex[1]=0,s.multiArray[2]=["请选择"],s.multiIndex[2]=0,a.regionArray=s.multiArray,a.regionIndex=s.multiIndex,a.regionData=s.multiData}a.region=s.multiArray[0][s.multiIndex[0]]+"xx市xx县"}});break;case 1:var r=s.multiData[1][s.multiIndex[1]].code;t.request({url:"https://www.dpsoft.top/district.jsp",method:"POST",data:{code:r},header:{"Content-Type":"application/json"},success:function(t){if(console.log(t.data),"ok"==t.data.status){for(var e in s.multiData[2]=t.data.data,s.multiArray[2]=[],t.data.data){var o=t.data.data[e];s.multiArray[2].push(o.name)}s.multiIndex[2]=0,i.regionArray=s.multiArray,i.regionIndex=s.multiIndex,i.regionData=s.multiData}a.region=s.multiArray[0][s.multiIndex[0]]+s.multiArray[1][s.multiIndex[1]]+"xx县"}});break;case 2:this.region=s.multiArray[0][s.multiIndex[0]]+s.multiArray[1][s.multiIndex[1]]+s.multiArray[2][s.multiIndex[2]];break}},countChange:function(t){this.count=t},alipay:function(){},wxpay:function(){var e=this;if(this.receiver.trim().length<=0)t.showToast({icon:"none",title:"请填写收货人姓名"});else{var a=/^[1][3,4,5,7,8,9][0-9]{9}$/;if(null!=this.phone&&this.phone.trim().length>0&&a.test(this.phone))if("请选择"!=this.regionArray[0][this.regionIndex[0]])if("请选择"!=this.regionArray[1][this.regionIndex[1]])if("请选择"!=this.regionArray[2][this.regionIndex[2]])if(this.address.trim().length<=0)t.showToast({icon:"none",title:"请选填写收货详细地址"});else{var i={};i.goods_id=this.goods.id,i.number=this.count,i.remark=this.remark,i.receiver=this.receiver,i.phone=this.phone,i.address=this.regionArray[0][this.regionIndex[0]]+this.regionArray[1][this.regionIndex[1]]+this.regionArray[2][this.regionIndex[2]]+this.address,i.style=this.goods.style[this.styleIndex],t.showLoading({title:"加载中",mask:!0}),this.getOpenId(function(a){console.log(a),a&&(i.openId=a.data.data.openid),e.postJson({path:"/order_wxpay_init.jsp",data:i,success:function(e){if(t.hideLoading(),"ok"==e.data.status){var a=e.data.data;a.success=function(e){t.showToast({title:"支付成功"}),t.redirectTo({url:"/pages/order/order?code"+a.code})},a.fail=function(e){t.showToast({icon:"none",title:"支付失败"})},a.provider="wxpay",t.requestPayment(a)}else t.showToast({icon:"none",title:e.data.msg})}})})}else t.showToast({icon:"none",title:"请选择收货地址市县"});else t.showToast({icon:"none",title:"请选择收货地址城市"});else t.showToast({icon:"none",title:"请选择收货地址省份"});else t.showToast({icon:"none",title:"请输入正确的收货人手机号"})}}}};e.default=o}).call(this,a("f266")["default"])},"4a6b":function(t,e,a){"use strict";a("719a");var i=o(a("7a76")),s=o(a("3a53"));function o(t){return t&&t.__esModule?t:{default:t}}i.default.mpType="page";var r=new s.default(i.default);r.$mount()},"7a76":function(t,e,a){"use strict";a.r(e);var i=a("266a"),s=a("1980");for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);var r=a("2877"),n=Object(r["a"])(s["default"],i["a"],i["b"],!1,null,null,null);e["default"]=n.exports}},[["4a6b","common/runtime","common/vendor"]]]);